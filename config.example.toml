# Example configuration file for Distributed File Transfer System
# Copy this file to config.toml and modify as needed

[node]
# Node name (used in certificate Common Name)
name = "node-1"

# gRPC server listen address
# Use 0.0.0.0 to listen on all interfaces
listen_address = "0.0.0.0:50051"

# Path to certificate file (auto-generated if not exists)
certificate_path = "./certs/node.crt"

# Path to private key file (auto-generated if not exists)
private_key_path = "./certs/node.key"

[network]
# Port for P2P gossip network (libp2p)
p2p_port = 9000

# List of other nodes to connect to initially
# Example: ["192.168.1.100:9000", "192.168.1.101:9000"]
bootstrap_nodes = []

# Heartbeat interval in seconds (how often to send keepalive)
heartbeat_interval = 30

# Node timeout in seconds (consider node stale after this period)
node_timeout = 300

[storage]
# Root directory for file storage
# Files will be organized by client IP: ./storage/192.168.1.100/filename
root_dir = "./storage"

# Maximum file size in bytes (0 = unlimited)
# Example: 10737418240 for 10GB limit
max_file_size = 0

# Chunk size for streaming in bytes
# Larger chunks = fewer round trips, but more memory usage
# Default: 1MB (1048576 bytes)
chunk_size = 1048576

[security]
# Allow self-signed certificates
# Set to false for production with proper CA
allow_self_signed = true

# Certificate validity period in days
cert_validity_days = 365

# Require mutual TLS authentication
# Set to false to allow unauthenticated connections (NOT recommended)
require_mtls = true

# Network secret for node authorization (HIGHLY RECOMMENDED!)
# If set, nodes must provide this secret to join the network
# This prevents unauthorized nodes from joining
#
# ‚ö†Ô∏è  SECURITY WARNING: Leaving this unset allows ANYONE to join your network!
# ‚ö†Ô∏è  For production, ALWAYS set a strong random secret!
#
# Generate a strong secret with: openssl rand -hex 32
# Or use any long random string
#
# Uncomment and set for production:
# network_secret = "your-super-secret-passphrase-change-me-now-use-openssl-rand-hex-32"
#
# Example:
# network_secret = "a3f4c2b1d5e8f9a2b4c6d8e1f3a5b7c9d2e4f6a8b1c3d5e7f9a2b4c6d8e1f3a5"

[network_ids]
# Enable network ID management system
# If false, nodes will use auto-generated IDs (backward compatible mode)
enabled = false

# Path to network IDs configuration file
ids_config_path = "./config/network_ids.toml"

# Path to network state database (persistent storage)
state_db_path = "./data/network_state.json"

# ID reservation timeout in seconds (5 minutes by default)
# If a node reserves an ID but doesn't complete joining within this time, ID is released
reservation_timeout = 300

# Offline threshold in seconds (24 hours by default)
# Nodes offline for longer than this will be removed from the network
offline_threshold = 86400

# Cleanup interval in seconds (1 hour by default)
# How often the system checks for stale nodes and expired reservations
cleanup_interval = 3600

# Enable auto-recovery for empty networks
# When true, first node can automatically restart an empty network
auto_recovery = true

# Maximum nodes per network type
[network_ids.max_nodes_per_network]
MainNet = 999   # Production network
TestNet = 99    # Testing network
DevNet = 49     # Development network
CustomNet = 99  # Custom networks

# üìù NETWORK ID MANAGEMENT SETUP GUIDE:
#
# 1. ENABLE THE SYSTEM:
#    Set `enabled = true` to use the new ID management system
#
# 2. GENERATE NETWORK SECRET:
#    Use the same `network_secret` for all nodes in your network
#    openssl rand -hex 32
#
# 3. CHOOSE FIRST NODE:
#    The first node to start will be the bootstrap node
#    It can choose any ID from the predefined list in network_ids.toml
#
# 4. NODE JOIN PROCESS:
#    - First node: Picks any available ID from the pool
#    - Other nodes: Must request ID reservation, then confirm assignment
#    - All nodes: Must provide valid network secret
#
# 5. IP RECLAMATION:
#    - Nodes offline > 24h are removed
#    - Returning nodes can reclaim old IDs if still available
#    - IP verification prevents spoofing
#
# 6. NETWORK RECOVERY:
#    If all nodes go offline, any node can restart the network
#    The system automatically detects empty network state
#
# ‚ö†Ô∏è SECURITY NOTES:
# - Always use a strong network_secret in production
# - Keep network_ids.toml secure (defines allowed IDs)
# - Monitor network state for unauthorized nodes
# - Regular backups of network_state.json recommended
